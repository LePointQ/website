{{ define "main" }}
	<main>
		<h1>{{ .Title | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}</h1>

		<div class='edito'>
			{{ .Params.edito | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}
		</div>

		{{ with .Site.GetPage .Params.temoignages }}
			<article>
				<p class='separator'>‚óè ‚óè ‚óè</p>

				<img src="{{ .Site.BaseURL }}{{ .Params.image }}" class='hero' />
				<h2>üí¨ {{ .Title | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}</h2>
				{{ if gt (len .Params.authors) 0 }}
					<h3>
						{{ if eq (len .Params.authors) 1 }}
							<img src="{{ .Site.BaseURL }}/media/team/{{ index .Params.authors 0 }}.jpg" width="40" height="40" class="author-pic" />
						{{ end }}
						<span style="">Par {{ delimit .Params.authors ", " " & " }}</span>
					</h3>
				{{ end }}

				{{ .Params.text | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}
			</article>
		{{ end }}

		{{ with .Site.GetPage .Params.vu_d_ailleurs }}
			<article>
				<p class='separator'>‚óè ‚óè ‚óè</p>

				<img src="{{ .Site.BaseURL }}{{ .Params.image }}" class='hero' />

				<h2>üåè Vu d'ailleurs</h2>
				{{ if gt (len .Params.authors) 0 }}
					<h3>
						{{ if eq (len .Params.authors) 1 }}
							<img src="{{ .Site.BaseURL }}/media/team/{{ index .Params.authors 0 }}.jpg" width="40" height="40" class="author-pic" />
						{{ end }}
						<span style="">Par {{ delimit .Params.authors ", " " & " }}</span>
					</h3>
				{{ end }}
				<h4>{{ .Title | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}</h4>

				{{ .Params.text | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}
			</article>
		{{ end }}

		{{ with .Site.GetPage .Params.on_debunke }}
			<article>
				<p class='separator'>‚óè ‚óè ‚óè</p>

				<img src="{{ .Site.BaseURL }}{{ .Params.image }}" class='hero' />

				<h2>üîé On d√©bunke&nbsp;!</h2>
				{{ if gt (len .Params.authors) 0 }}
					<h3>
						{{ if eq (len .Params.authors) 1 }}
							<img src="{{ .Site.BaseURL }}/media/team/{{ index .Params.authors 0 }}.jpg" width="40" height="40" class="author-pic" />
						{{ end }}
						<span style="">Par {{ delimit .Params.authors ", " " & " }}</span>
					</h3>
				{{ end }}
				<h4>{{ .Title | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}</h4>

				{{ if eq .Params.veracity "Faux" }}
					<p class='veracity fake'>FAUX</p>
				{{ else if eq .Params.veracity "Vrai" }}
					<p class='veracity true'>VRAI</p>
				{{ else }}
					<p class='veracity trueish'>PAS EXACTEMENT</p>
				{{ end }}

				{{ .Params.text | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}
			</article>
		{{ end }}

		{{ with .Site.GetPage .Params.la_bonne_nouvelle }}
			<article>
				<p class='separator'>‚óè ‚óè ‚óè</p>

				<img src="{{ .Site.BaseURL }}{{ .Params.image }}" class='hero' />

				<h2>üí° La bonne nouvelle</h2>
				{{ if gt (len .Params.authors) 0 }}
					<h3>
						{{ if eq (len .Params.authors) 1 }}
							<img src="{{ .Site.BaseURL }}/media/team/{{ index .Params.authors 0 }}.jpg" width="40" height="40" class="author-pic" />
						{{ end }}
						<span style="">Par {{ delimit .Params.authors ", " " & " }}</span>
					</h3>
				{{ end }}
				<h4>{{ .Title | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}</h4>

				{{ .Params.text | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}

				<p class='separator'>‚óè ‚óè ‚óè</p>
			</article>
		{{ end }}

		<div class='outro'>
			{{ .Params.outro | replaceRE "\"[^\"]*\"" "&laquo;&nbsp;$0&nbsp;&raquo;" | replaceRE "\"" "" | markdownify }}
		</div>

	</main>
	{{ partial "paywall" }}
{{ end }}

{{ define "page-script" }}
	<script>
		window.addEventListener('load', () => {
			if (sessionStorage.getItem('status') !== 'subscribed') {
				document.querySelector('.paywall').classList.add('visible');
				document.querySelector('main').classList.add('blurred');
			}
		});

		document.querySelector('#unlock').addEventListener('submit', async (e) => {
			e.preventDefault();
			document.querySelectorAll('.paywall *:not(.separator)').forEach(e => e.style.visibility = 'hidden');
			document.querySelector('.paywall > .separator').classList.add('animated');
			const response = await fetch("https://europe-west1-le-point-q.cloudfunctions.net/isContact?email=" + e.target.email.value);
			const { status } = await response.json();
			if (status === 'subscribed') {
				document.querySelector('main').classList.remove('blurred');
				document.querySelector('.paywall').classList.remove('visible');
				sessionStorage.setItem('status', 'subscribed');
			}
			else {
				document.querySelectorAll('.paywall *:not(.separator)').forEach(e => e.style.visibility = 'visible');
				document.querySelector('.paywall .separator').classList.remove('animated');
			}
		});

		document.querySelector('#subscribe').addEventListener('submit', async (e) => {
			e.preventDefault();
			fetch("https://europe-west1-le-point-q.cloudfunctions.net/addContact?email=" + e.target.email.value);
			document.querySelector('main').classList.remove('blurred');
			document.querySelector('.paywall').classList.remove('visible');
			sessionStorage.setItem('status', 'subscribed');
		});
	</script>
{{ end }}
